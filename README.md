# 📱 IoT 기반 웹 방명록 시스템
> Raspberry Pi + Flask + OpenCV + MQTT 기반의 실시간 방문 기록 시스템

## 📌 작품 개요
라즈베리파이를 활용한 방명록 시스템은 가족이나 친구들이 우리 집에 방문했을 때 소중한 순간을 기록하기 위한 특별한 시스템이다. 이 시스템은 라즈베리파이, 카메라, 초음파 센서, LED 그리고 온습도 센서로 구성되어 있다. 시스템은 방문객이 초기 화면을 보고 ‘방명록 남기기‘를 클릭한다. 그 후에 카메라 앞에 서서 이름을 입력하고 ‘사진 찍기’를 클릭하면 3초 후에 자동으로 사진을 촬영하여 방명록이 작성된다. 초음파 센서는 50cm에서 60cm 사이의 거리를 감지하면 화면에 현재 거리를 표시하고 빨간색 LED을 점등하여 사진 찍기 좋은 거리를 시각적으로 알려준다. 또한, 사진 촬영 시 하얀색 LED가 플래시 역할을 하여 더 나은 사진을 찍을 수 있다. ‘방명록 보기’를 클릭하면 우리집에 온 누적 방문객과 방문 날짜를 확인할 수 있다. 온습도 센서를 통해 집안의 온도와 습도를 확인할 수 있다.

시스템 구조는 다음 그림과 같다.

![image](https://github.com/user-attachments/assets/c1d64019-34e1-4fb9-ace7-37fa30e728a8)


## 🧩 구현 방법
### 1. 하드웨어
라즈베리파이에 카메라 2대, 초음파 센서 1개, 온습도 센서 1개, LED 6개와 PC를 사용한다.

이들의 각 GPIO 핀은 다음과 같다.

초음파 센서 : GPIO16, GPIO20
온습도 센서 : GPIO2(SDA), GPIO3(SCL)
LED : GPIO5, GPIO6, GPIO12, GPIO18, GPIO23, GPIO24

[회로사진]
![image](https://github.com/user-attachments/assets/d2d0280d-95b2-4e38-894d-0fa348146f9b)

[시스템 구성 사진]
![image](https://github.com/user-attachments/assets/d59b5206-2d59-4ab2-a7ac-5f7bc1e2de8a)

### 2. 소프트웨어
소프트웨어는 총 9개의 부분을 설계한다.

1. LED와 센서를 제어하는 파이선 코드
   - LED 상태를 제어하는 기능과 물체와의 거리를 측정하고 주변 환경의 온도를 모니터링하는 기능을 제공하는 파이선 코드이다.
2. 카메라를 제어하는 파이선 코드
   - OpenCV를 사용하여 카메라를 초기화하고, 사진을 촬영하는 기능을 제공하는 파이선 코드이다.
3. MQTT 브로커에 접속하고 메시지를 전송하는 파이선 코드
   - MQTT 프로토콜을 활용하여 거리, 온도 및 카메라 이미지 정보를 주기적으로 브로커에 전송하고, LED를 거리에 따라 제어하는 파이선 코드이다.
4. 웹 브라우저로부터 접속과 요청을 처리하는 플라스크 앱
   - 웹 브라우저로부터의 접속과 요청을 처리하며, OpenCV를 사용하여 카메라로부터 이미지를 촬영, 방문객의 정보를 기록, 방문객 목록을 확인하는 플라스크 앱이다.
5. 방문을 환영하는 웹 페이지
   - 환영과 안내 메시지, 방명록 남기기 및 보기에 대한 폼이 포함된 초기 웹 페이지이다.
6. 온도, 거리 정보, 실시간 모습을 출력하며, 이름을 입력하고 사진 찍기를 누르는 웹 페이지
   - 사용자에게 빨간불이 뜨는 위치에서 사진을 찍을 것을 권고하는 메시지와, MQTT를 통해 거리 및 온도 정보를 표시하고 사진을 찍을 수 있는 버튼을 제공하는 웹 페이지이다.
7. 찍은 사진을 출력하는 웹 페이지
   - 방문자의 사진을 환영 메시지와 함께 표시하며, 방명록을 보기 위한 버튼을 제공하는 웹 페이지이다.
8. 누적 방문객을 확인할 수 있는 웹 페이지
   - 이름, 이미지 및 날짜를 나열하며 홈으로 돌아가는 버튼을 제공하는 방명록 웹 페이지이다.
  9. MQTT 브로커에게 접속하고 메시지를 수신할 수 있는 자바스크립트
      - 카운트다운 함수, 폼 제출 함수, 콜백 함수, 이미지를 캔버스에 그리는 함수 등을 포함하며, MQTT를 활용하여 거리, 온도 및 이미지 데이터를 수신하고, 그에 따라 동적으로 웹 페이지를 업데이트하는 자바스크립트이다.


## 🎨 실행 과정
1. **초기 화면**
프로그램을 처음 실행했을 때, 웹 페이지에는 방문을 환영하는 문구와 함께 방명록을 남기는 방법, 그리고 “방명록 남기기” 버튼과 “방명록 보기” 버튼이 표시된다.
![image](https://github.com/user-attachments/assets/56ab0196-c552-48df-bd33-d49a7d80f5a4)

2. **"방명록 보기"를 클릭했을 때 웹 페이지**
초기 웹 페이지에서 “방명록 보기”를 선택하면, 이전에 남겼던 방명록들을 확인할 수 있다.
![image](https://github.com/user-attachments/assets/b28bc90f-4476-4d4d-8d72-2e587e0d8fa2)

3. **사람이 방명록을 남기러 다가가는 경우**
방명록을 남기기 위해 집에 놀러 온 친구가 다가가는 상황이다.
![image](https://github.com/user-attachments/assets/dfe74cd5-8a9d-4f11-998d-baa0088d10d7)

4. **"방명록 남기기를 클릭했을 때 웹 페이지**
초기 웹 페이지에서 “방명록 남기기”를 클릭했을 때의 웹 페이지이다.
빨간 불이 표시되는 위치에 서서 사진을 찍으면 잘 나온다는 유용한 팁과 함께 현재의 거리와 온도가 출력된다. 또한, 이름을 입력하는 텍스트 창과 “사진 찍기” 버튼이 제공되며, 현재의 실시간 사진도 화면에 표시된다.
![image](https://github.com/user-attachments/assets/45af80a4-64f8-4233-a85f-269abf63ab58)

5. **50cm에서 60cm 사이에 위치하려는 경우**
친구가 사진을 50cm에서 60cm 사이에서 찍기 위해 접근했을 때의 상황이다.
![image](https://github.com/user-attachments/assets/b46c7481-987e-4c53-80e0-8a1f9dbaa529)

6. **빨간 LED가 켜진 모습**
센서와의 거리가 50cm에서 60cm 사이라면 빨간 LED에 불이 들어온다. 다음은 친구가 50cm에서 60cm 사이에 위치한 경우이다.
![image](https://github.com/user-attachments/assets/cd29d0e2-fd66-4264-b2a0-443fae72bb4b)

7. **이름을 입력하고 "사진 찍기"를 클릭했을 때 웹 페이지**
이름을 입력하고 “사진 찍기”를 클릭하면 다음과 같이 이름을 입력하는 텍스트 창 밑에 “3”, “2”, “1”, “스마일~!“이 순서대로 출력된다. 그리고 사진이 찍히게 된다.
![image](https://github.com/user-attachments/assets/4b1c59f9-407e-4028-927b-4fbdec1885de)
![image](https://github.com/user-attachments/assets/a0cb7194-69e2-4c33-880c-956e8561777d)

8. **사진이 찍힐 경우**
사진이 찍힐 때 다음과 같이 카메라 근처에 있는 흰색 LED가 켜진다.
![image](https://github.com/user-attachments/assets/e8ae68b1-df76-4984-8847-34e8794d11f1)

9. **사진이 찍혔을 경우**
다음과 같이 사진이 찍히고 나서 흰색 LED가 꺼진다.
![image](https://github.com/user-attachments/assets/46c85de4-ebd5-4a86-8175-4737d1115ac5)

10. **사진이 찍혔을 때 웹 페이지**
다음은 사진이 찍혔을 때 이름과 함께 찍힌 사진이 출력되며 ”방명록 보기“ 버튼이 제공되는 웹 페이지이다.
![image](https://github.com/user-attachments/assets/194205b9-0486-451f-a3f7-ce0ce63720e9)

11. **"방명록 보기"를 눌렀을 때 웹 페이지**
“방명록 보기”를 클릭하면 지금까지 집에 방문한 방문객의 이름과 사진, 그리고 방문한 날짜가 순서대로 출력된다.
![image](https://github.com/user-attachments/assets/bd366996-aba7-4ca8-b4dd-5e3bd76fcc11)

12. **"홈으로 돌아가기"를 클릭했을 때 웹 페이지**
홈으로 돌아가기를 클릭하면 다시 처음 화면으로 돌아가게 된다. 여기서 “방명록 남기기“로 다시 방명록을 남길 수 있고, ”방명록 보기“로 방명록을 확인할 수 있다.
![image](https://github.com/user-attachments/assets/6a3387a9-f5c1-4438-9c54-f32cb7fa313e)


## 📁 파일 구조
- 'camera.py', 'circuit.py', 'miniapp.py', 'mqtt_pub.py'
- 'guest_book.html', 'guests.html', 'opening.html', 'take_picture.html'
- 'script.js'

## 🧠 배운 점
- 회로 구성 및 센서 제어
- 전체 시스템 흐름 설계

## ✅ 향후 개선점
- UI 개선
- 사진 다운로드 또는 삭제 기능 추가
